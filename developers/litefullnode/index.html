<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>如何使用LiteFullnode工具 - 波场中文文档</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "\u5982\u4f55\u4f7f\u7528LiteFullnode\u5de5\u5177";
    var mkdocs_page_input_path = "developers/litefullnode.md";
    var mkdocs_page_url = "/documentation-zh/introduction/developers/litefullnode/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> 波场中文文档</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">首页</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">简介</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../introduction/">项目仓库</a>
                </li>
                <li class="">
                    
    <a class="" href="../../introduction/dpos/">波场共识</a>
                </li>
                <li class="">
                    
    <a class="" href="../../introduction/overview/">波场概览</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">API 接口</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../api/http/">HTTP 接口</a>
                </li>
                <li class="">
                    
    <a class="" href="../../api/rpc/">RPC 接口</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">机制与算法</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/sr/">超级代表与委员会</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/trc10/">TRC-10</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/account/">账户模型</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/resource/">资源模型</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/dex/">去中心化交易所</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/multi-signatures/">多重签名</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/shielded-TRC20-contract/">匿名合约</a>
                </li>
                <li class="">
                    
    <a class="" href="../../mechanism-algorithm/system-contracts/">系统合约</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">架构介绍</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../architecture/network/">网络</a>
                </li>
                <li class="">
                    
    <a class="" href="../../architecture/database/">数据储存</a>
                </li>
                <li class="">
                    
    <a class="" href="../../architecture/event/">事件插件</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">智能合约文档</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../contracts/tvm/">虚拟机</a>
                </li>
                <li class="">
                    
    <a class="" href="../../contracts/compiler/">编译器</a>
                </li>
                <li class="">
                    
    <a class="" href="../../contracts/contract/">合约</a>
                </li>
                <li class="">
                    
    <a class="" href="../../contracts/trc20/">TRC-20</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">开发者文档</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../official-public-nodes/">官方节点</a>
                </li>
                <li class="">
                    
    <a class="" href="../deployment/">部署</a>
                </li>
                <li class="">
                    
    <a class="" href="../archive-manifest/">levelDB 启动优化插件</a>
                </li>
                <li class="">
                    
    <a class="" href="../run-in-idea/">在 IDEA 中启动节点</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">如何使用LiteFullnode工具</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#_1">微节点工具</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#_2">介绍</a></li>
        
            <li><a class="toctree-l4" href="#_3">使用</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../contribution/">如何参与开发</a>
                </li>
                <li class="">
                    
    <a class="" href="../incentives/">开发者激励</a>
                </li>
                <li class="">
                    
    <a class="" href="../java-tron/">Java-Tron</a>
                </li>
                <li class="">
                    
    <a class="" href="../tips/">TIPs</a>
                </li>
                <li class="">
                    
    <a class="" href="../advanced-configuration/">高级配置项</a>
                </li>
                <li class="">
                    
    <a class="" href="../resources/">其他参考资源</a>
                </li>
                <li class="">
                    
    <a class="" href="../gpg/">联系我们（GPG Key）</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">客户端</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../clients/wallet-cli/">命令行钱包</a>
                </li>
                <li class="">
                    
    <a class="" href="../../clients/tron-grid/">TronGrid</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">版本发布</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../releases/">一致性检验</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../faq/">常见问题</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../glossary/">术语表</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">波场中文文档</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>开发者文档 &raquo;</li>
        
      
    
    <li>如何使用LiteFullnode工具</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/tronprotocol/documentation-zh/edit/master/docs/developers/litefullnode.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="_1">微节点工具<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<h2 id="_2">介绍<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>微节点（Lite FullNode）工具用于将全节点（FullNode）的数据切分成快照数据集（Snapshot dataset）和历史数据集（History dataset）两部分。</p>
<ul>
<li><code>Snapshot dataset</code>: 用于快速启动Lite FullNode节点的必要数据集。</li>
<li><code>History dataset</code>: 用于历史数据查询的归档数据集。</li>
</ul>
<p>使用本工具进行任何操作之前，需要首先停止当前运行的FullNode节点。 此工具提供了根据当前<code>最新区块高度</code>(latest_block_number)将完整数据切分成两个数据集的功能。通过快照数据集启动的微节点不支持查询此区块高度之前的历史数据。此工具还提供了将历史数据集同快照数据集合并的功能。 更多的API使用详情可以参考<a href="#httpgrpc-apis">HTTP&amp;GRPC APIs</a></p>
<p>更多的设计思想，请参考: <a href="https://github.com/tronprotocol/tips/issues/128">TIP128</a></p>
<h2 id="_3">使用<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="_4">选项<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>此工具提供了快照数据集和历史数据集独立的拆分功能和合并功能。</p>
<ul>
<li><code>--operation | -o</code>: [ split | merge ]  此选项用于指定使用拆分功能还是合并功能。</li>
<li><code>--type | -t</code>: [ snapshot | history ]  此选项只能同<code>-o split</code>配合使用。 <code>snapshot</code> 指示切分为快照数据集，<code>history</code>指示切分为历史数据集。 </li>
<li><code>--fn-data-path</code>: FullNode数据库的目录。</li>
<li><code>--dataset-path</code>: 切分完成的数据集输出目录。 当操作类型是 <code>split</code>时, <code>dataset-path</code> 用于指示切分完成的快照数据集输出目录或者历史数据集输出目录；当操作类型是 <code>merge</code>时， <code>dataset-path</code>指示历史数据集的输出目录。</li>
</ul>
<h3 id="_5">例子<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>通过默认的配置文件启动全节点时，将在当前启动目录下生成一个<code>output-directory</code>目录，在<code>output-directory</code> 目录的<code>database</code>子目录就是将要被切分的数据库。 </p>
<h4 id="_6">切分快照数据集<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h4>
<p>首先, 停止FullNode并执行命令:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 简单起见，将快照数据集存放在`/tmp`目录下</span>
java -jar LiteFullNodeTool.jar -o split -t snapshot --fn-data-path output-directory/database --dataset-path /tmp
</code></pre></div>
<p>命令执行完毕之后，将在<code>/tmp</code>目录下生成<code>snapshot</code>目录, 将此目录的名字修改为<code>database</code>，并拷贝到Lite FullNode的运行目录output-directory之下。 </p>
<h4 id="_7">切分历史数据集<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h4>
<p>如果需要查询历史数据，历史数据集必须被生成并合并到微节点数据库中。</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 简单起见，将历史数据集存放在`/tmp`目录下</span>
java -jar LiteFullNodeTool.jar -o split -t <span class="nb">history</span> --fn-data-path output-directory/database --dataset-path /tmp
</code></pre></div>
<p>命令执行完毕之后，将在<code>/tmp</code>目录下生成<code>history</code>目录，将此目录拷贝到Lite FullNode运行目录output-directory之下，注意需要确保有足够的硬盘空间来存储历史数据集。</p>
<h4 id="merge">Merge<a class="headerlink" href="#merge" title="Permanent link">&para;</a></h4>
<p>历史数据集和快照数据集中都保存了一个info.properties文件，用于记录数据拆分时的区块高度。需要注意的是，两个数据集进行合并时，历史数据集的区块高度必须大于等于快照数据集的区块高度。通过merge操作将历史数据集同快照数据集进行合并之后，微节点将成为一个真正的全节点。</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 简单起见，假设历史数据集存放在了`/tmp`目录下</span>
java -jar LiteFullNodeTool.jar -o merge --fn-data-path output-directory/database --dataset-path /tmp/history
</code></pre></div>
<h3 id="httpgrpc-apis">HTTP&amp;GRPC APIs<a class="headerlink" href="#httpgrpc-apis" title="Permanent link">&para;</a></h3>
<p>目前一些API在微节点上暂不支持，列表如下:</p>
<h4 id="http">HTTP<a class="headerlink" href="#http" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>wallet/</th>
<th>walletsolidity/</th>
</tr>
</thead>
<tbody>
<tr>
<td>getblockbyid</td>
<td>getblockbyid</td>
</tr>
<tr>
<td>getblockbylatestnum</td>
<td>getblockbylatestnum</td>
</tr>
<tr>
<td>getblockbylimitnext</td>
<td>getblockbylimitnext</td>
</tr>
<tr>
<td>getblockbynum</td>
<td>getblockbynum</td>
</tr>
<tr>
<td>getmerkletreevoucherinfo</td>
<td>getmerkletreevoucherinfo</td>
</tr>
<tr>
<td>gettransactionbyid</td>
<td>gettransactionbyid</td>
</tr>
<tr>
<td>gettransactioncountbyblocknum</td>
<td>gettransactioncountbyblocknum</td>
</tr>
<tr>
<td>gettransactioninfobyid</td>
<td>gettransactioninfobyid</td>
</tr>
<tr>
<td>gettransactionreceiptbyid</td>
<td></td>
</tr>
<tr>
<td>isspend</td>
<td>isspend</td>
</tr>
<tr>
<td>scanandmarknotebyivk</td>
<td>scanandmarknotebyivk</td>
</tr>
<tr>
<td>scannotebyivk</td>
<td>scannotebyivk</td>
</tr>
<tr>
<td>scannotebyovk</td>
<td>scannotebyovk</td>
</tr>
<tr>
<td>totaltransaction</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="grpc">gRPC<a class="headerlink" href="#grpc" title="Permanent link">&para;</a></h4>
<table>
<thead>
<tr>
<th>protocol.Wallet</th>
<th>protocol.WalletSolidity</th>
<th>protocol.Database</th>
</tr>
</thead>
<tbody>
<tr>
<td>GetBlockById</td>
<td></td>
<td></td>
</tr>
<tr>
<td>GetBlockByLatestNum</td>
<td></td>
<td></td>
</tr>
<tr>
<td>GetBlockByLatestNum2</td>
<td></td>
<td></td>
</tr>
<tr>
<td>GetBlockByLimitNext</td>
<td></td>
<td></td>
</tr>
<tr>
<td>GetBlockByLimitNext2</td>
<td></td>
<td></td>
</tr>
<tr>
<td>GetBlockByNum</td>
<td>GetBlockByNum</td>
<td>GetBlockByNum</td>
</tr>
<tr>
<td>GetBlockByNum2</td>
<td>GetBlockByNum2</td>
<td></td>
</tr>
<tr>
<td>GetMerkleTreeVoucherInfo</td>
<td>GetMerkleTreeVoucherInfo</td>
<td></td>
</tr>
<tr>
<td>GetTransactionById</td>
<td>GetTransactionById</td>
<td></td>
</tr>
<tr>
<td>GetTransactionCountByBlockNum</td>
<td>GetTransactionCountByBlockNum</td>
<td></td>
</tr>
<tr>
<td>GetTransactionInfoById</td>
<td>GetTransactionInfoById</td>
<td></td>
</tr>
<tr>
<td>IsSpend</td>
<td>IsSpend</td>
<td></td>
</tr>
<tr>
<td>ScanAndMarkNoteByIvk</td>
<td>ScanAndMarkNoteByIvk</td>
<td></td>
</tr>
<tr>
<td>ScanNoteByIvk</td>
<td>ScanNoteByIvk</td>
<td></td>
</tr>
<tr>
<td>ScanNoteByOvk</td>
<td>ScanNoteByOvk</td>
<td></td>
</tr>
<tr>
<td>TotalTransaction</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>这些API可以通过在配置文件中配置 <code>openHistoryQueryWhenLiteFN = true</code>来强制打开，但不推荐这样做。</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../contribution/" class="btn btn-neutral float-right" title="如何参与开发">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../run-in-idea/" class="btn btn-neutral" title="在 IDEA 中启动节点"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/tronprotocol/documentation-zh/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../run-in-idea/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../contribution/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
      <script src="../../search/main.js" defer></script>

</body>
</html>
